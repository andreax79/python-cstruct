<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Python CStruct documentation</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Introduction";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> Python CStruct documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">Introduction</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#install">Install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#features">Features</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#structs">Structs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#unions">Unions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#enums">Enums</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#nested-structsunions">Nested structs/unions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#byte-order-size-and-padding">Byte Order, Size, and Padding</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#flexible-array-member">Flexible Array Member</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pack-and-unpack">Pack and Unpack</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#define-sizeof-and-eval">Define, Sizeof, and Eval</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ispect-memory">Ispect memory</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="changelog/">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="license/">License</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="CODE_OF_CONDUCT/">Code of Conduct</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="https://github.com/andreax79/python-cstruct">Source Code Repository</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="examples/fdisk/">fdisk.py</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/flexible_array/">flexible_array.py</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/who/">who.py</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="api/module/">cstruct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/abstract/">cstruct.abstract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/base/">cstruct.base</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/c_expr/">cstruct.c_expr</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/c_parser/">cstruct.c_parser</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/cstruct/">cstruct.cstruct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/field/">cstruct.field</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/mem_cstruct/">cstruct.mem_cstruct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api/native_types/">cstruct.native_types</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">Python CStruct documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Introduction</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="python-cstruct">Python-CStruct</h1>
<p>C-style structs for Python</p>
<p><a href="https://github.com/andreax79/python-cstruct/actions"><img alt="Build Status" src="https://github.com/andreax79/python-cstruct/workflows/Tests/badge.svg" /></a>
<a href="https://badge.fury.io/py/cstruct"><img alt="PyPI version" src="https://badge.fury.io/py/cstruct.svg" /></a>
<a href="https://pypi.org/project/cstruct"><img alt="PyPI" src="https://img.shields.io/pypi/pyversions/cstruct.svg" /></a>
<a href="https://pepy.tech/project/cstruct"><img alt="Downloads" src="https://pepy.tech/badge/cstruct/month" /></a>
<a href="https://github.com/psf/black"><img alt="Code style: black" src="https://img.shields.io/badge/code%20style-black-000000.svg" /></a>
<a href="https://snyk.io/test/github/andreax79/python-cstruct"><img alt="Known Vulnerabilities" src="https://snyk.io/test/github/andreax79/python-cstruct/badge.svg" /></a>
<a href="https://python-cstruct.readthedocs.io/en/latest/"><img alt="Documentation" src="https://readthedocs.org/projects/python-cstruct/badge/?version=latest" /></a></p>
<p>Convert C struct/union definitions into Python classes with methods for
serializing/deserializing.</p>
<p>The usage is very simple: create a class subclassing
<a href="https://python-cstruct.readthedocs.io/en/latest/api/mem_cstruct/"><code>cstruct.MemCStruct</code></a>
and add a C struct/union definition as a string in the <code>__def__</code> field.</p>
<p>The C struct/union definition is parsed at runtime and the struct format string
is generated. The class offers the method <code>unpack</code> for deserializing
an array of bytes into a Python object and the method <code>pack</code> for
serializing the values into an array of bytes.</p>
<h2 id="install">Install</h2>
<pre><code>pip install cstruct
</code></pre>
<h2 id="examples">Examples</h2>
<ul>
<li><a href="https://python-cstruct.readthedocs.io/en/latest/examples/fdisk/">Read the DOS-type (MBR) partition table</a></li>
<li><a href="https://python-cstruct.readthedocs.io/en/latest/examples/who/">Print information about logged uses</a></li>
<li><a href="https://python-cstruct.readthedocs.io/en/latest/examples/flexible_array/">Flexible Array Member (FAM)</a></li>
</ul>
<h2 id="features">Features</h2>
<h3 id="structs">Structs</h3>
<p>Struct definition subclassing <code>cstruct.MemCStruct</code>. Methods can access stuct values as instance variables.</p>
<pre><code class="language-python">class Position(cstruct.MemCStruct):
    __def__ = &quot;&quot;&quot;
        struct {
            unsigned char head;
            unsigned char sector;
            unsigned char cyl;
        }
    &quot;&quot;&quot;
    @property
    def lba(self):
        return (self.cyl * 16 + self.head) * 63 + (self.sector - 1)

pos = Position(cyl=15, head=15, sector=63)
print(f&quot;head: {pos.head} sector: {pos.sector} cyl: {pos.cyl} lba: {pos.lba}&quot;)
</code></pre>
<p>Struct definition using <code>cstruct.parse</code>.</p>
<pre><code class="language-python">Partition = cstruct.parse(&quot;&quot;&quot;
    #define ACTIVE_FLAG         0x80

    struct Partition {
        unsigned char status;       /* 0x80 - active */
        struct Position start;
        unsigned char partition_type;
        struct Position end;
        unsigned int start_sect;    /* starting sector counting from 0 */
        unsigned int sectors;       /* nr of sectors in partition */
    }
&quot;&quot;&quot;)

part = Partition()
part.status = cstruct.getdef('ACTIVE_FLAG')
</code></pre>
<h3 id="unions">Unions</h3>
<p>Union definition subclassing <code>cstruct.MemCStruct</code>.</p>
<pre><code class="language-python">class Data(cstruct.MemCStruct):
    __def__ = &quot;&quot;&quot;
        union {
            int integer;
            float real;
        }
    &quot;&quot;&quot;

data = Data()
data.integer = 2
data.real = 3
assert data.integer != 2
</code></pre>
<h3 id="enums">Enums</h3>
<p>Enum definition subclassing <code>cstruct.CEnum</code>.</p>
<pre><code class="language-python">class HtmlFont(cstruct.CEnum):
    __size__ = 2
    __def__ = &quot;&quot;&quot;
        #define NONE         0

        enum htmlfont {
            HTMLFONT_NONE = NONE,
            HTMLFONT_BOLD,
            HTMLFONT_ITALIC
        }
    &quot;&quot;&quot;

assert HtmlFont.HTMLFONT_NONE == 0
assert HtmlFont.HTMLFONT_BOLD == 1
assert HtmlFont.HTMLFONT_ITALIC == 2
</code></pre>
<p>Different enum styles are supported in struct/union definitions.</p>
<pre><code class="language-c">enum Type_A a;  // externally defined using CEnum
enum Type_B {A, B, C} b;
enum {A, B, C} c;
</code></pre>
<h3 id="nested-structsunions">Nested structs/unions</h3>
<p>Nested stucts and unions are supported, both named and anonymous.</p>
<pre><code class="language-python">class Packet(cstruct.MemCStruct):
    __def__ = &quot;&quot;&quot;
        struct Packet {
            uint8_t packetLength;
            union {
                struct {
                    uint16_t field1;
                    uint16_t field2;
                    uint16_t field3;
                } format1;
                struct {
                    double value1;
                    double value2;
                } format2;
            };
        };
    &quot;&quot;&quot;
</code></pre>
<h3 id="byte-order-size-and-padding">Byte Order, Size, and Padding</h3>
<p>Suported byte orders:</p>
<ul>
<li><code>cstruct.LITTLE_ENDIAN</code> - Little endian byte order, standard size, no padding</li>
<li><code>cstruct.BIG_ENDIAN</code> - Big endian byte order, standard size, no padding</li>
<li><code>cstruct.NATIVE_ORDER</code> - Native byte order, native size, padding</li>
</ul>
<pre><code class="language-python">class Native(cstruct.MemCStruct):
    __byte_order__ = cstruct.NATIVE_ORDER
    __def__ = &quot;&quot;&quot;
        struct {
            long p;
            char c;
            long x;
        }
    &quot;&quot;&quot;
</code></pre>
<h3 id="flexible-array-member">Flexible Array Member</h3>
<pre><code class="language-python">class Pkg(cstruct.MemCStruct):
    __byte_order__ = cstruct.LITTLE_ENDIAN
    __def__ = &quot;&quot;&quot;
        struct {
            uint16_t cmd;
            uint16_t length;
            uint8_t data[];
        }
    &quot;&quot;&quot;

pkg = Pkg()
pkg.length = 4
pkg.data = [10, 20, 30, 40]
</code></pre>
<h3 id="pack-and-unpack">Pack and Unpack</h3>
<p>A code example illustrating how to use
<a href="https://python-cstruct.readthedocs.io/en/latest/api/abstract/#cstruct.abstract.AbstractCStruct.pack"><code>pack</code></a> to pack a structure into binary form.</p>
<pre><code class="language-python">class Position(cstruct.MemCStruct):
    __byte_order__ = cstruct.LITTLE_ENDIAN
    __def__ = &quot;&quot;&quot;
        struct {
            unsigned char head;
            unsigned char sector;
            unsigned char cyl;
        }
    &quot;&quot;&quot;

pos = Position(head=10, sector=20, cyl=3)
packed = pos.pack()
</code></pre>
<p>Binary representation can be converted into structure using
<a href="https://python-cstruct.readthedocs.io/en/latest/api/abstract/#cstruct.abstract.AbstractCStruct.unpack"><code>unpack</code></a>.</p>
<pre><code>pos1 = Position()
pos1.unpack(packed)
assert pos1.head == 10
assert pos1.sector == 20
assert pos1.cyl == 3
</code></pre>
<h3 id="define-sizeof-and-eval">Define, Sizeof, and Eval</h3>
<p>Definitions in Struct declaration:</p>
<pre><code class="language-python">class Packet(cstruct.MemCStruct):
    __byte_order__ = cstruct.LITTLE_ENDIAN
    __def__ = &quot;&quot;&quot;
        #define MaxPacket 20

        struct Packet {
            uint8_t bytes[MaxPacket];
        }
    &quot;&quot;&quot;
</code></pre>
<p>Parse C definitions:</p>
<pre><code class="language-python">cstruct.parse(&quot;&quot;&quot;
    #define A1  10
    #define A2  10 + A1
    #define A3  30
&quot;&quot;&quot;)
assert cstruct.getdef(&quot;A1&quot;) == 10
assert cstruct.getdef('A2') == 20
</code></pre>
<p>Get structure size:</p>
<pre><code class="language-python">cstruct.sizeof(Partition)
</code></pre>
<p>Evaluate C expression using <a href="https://python-cstruct.readthedocs.io/en/latest/api/c_expr/"><code>c_eval</code></a>:</p>
<pre><code class="language-python">cstruct.c_eval(&quot;A1 / 10&quot;)
cstruct.c_eval(&quot;((A10 &lt; 6) || (A10&gt;10))&quot;)
</code></pre>
<p>C expressions are automatically evaluated during structure definitions:</p>
<pre><code class="language-python">class MBR(cstruct.MemCStruct):
    __byte_order__ = cstruct.LITTLE_ENDIAN
    __def__ = &quot;&quot;&quot;
        #define MBR_SIZE                    512
        #define MBR_DISK_SIGNATURE_SIZE       4
        #define MBR_USUALY_NULLS_SIZE         2
        #define MBR_SIGNATURE_SIZE            2
        #define MBR_BOOT_SIGNATURE       0xaa55
        #define MBR_PARTITIONS_NUM            4
        #define MBR_PARTITIONS_SIZE  (sizeof(Partition) * MBR_PARTITIONS_NUM)
        #define MBR_UNUSED_SIZE      (MBR_SIZE - MBR_DISK_SIGNATURE_SIZE - MBR_USUALY_NULLS_SIZE - MBR_PARTITIONS_SIZE - MBR_SIGNATURE_SIZE)

        struct {
            char unused[MBR_UNUSED_SIZE];
            unsigned char disk_signature[MBR_DISK_SIGNATURE_SIZE];
            unsigned char usualy_nulls[MBR_USUALY_NULLS_SIZE];
            struct Partition partitions[MBR_PARTITIONS_NUM];
            uint16 signature;
        }
    &quot;&quot;&quot;
</code></pre>
<h3 id="ispect-memory">Ispect memory</h3>
<p>The <a href="https://python-cstruct.readthedocs.io/en/latest/api/abstract/#cstruct.abstract.AbstractCStruct.inspect"><code>inspect</code></a> methods displays memory contents in hexadecimal.</p>
<pre><code class="language-python">print(mbr.inspect())
</code></pre>
<p>Output example:</p>
<pre><code>00000000  eb 48 90 00 00 00 00 00  00 00 00 00 00 00 00 00  |.H..............|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 03 02  |................|
00000040  ff 00 00 80 61 cb 04 00  00 08 fa 80 ca 80 ea 53  |....a..........S|
00000050  7c 00 00 31 c0 8e d8 8e  d0 bc 00 20 fb a0 40 7c  ||..1....... ..@||
00000060  3c ff 74 02 88 c2 52 be  79 7d e8 34 01 f6 c2 80  |&lt;.t...R.y}.4....|
00000070  74 54 b4 41 bb aa 55 cd  13 5a 52 72 49 81 fb 55  |tT.A..U..ZRrI..U|
00000080  aa 75 43 a0 41 7c 84 c0  75 05 83 e1 01 74 37 66  |.uC.A|..u....t7f|
00000090  8b 4c 10 be 05 7c c6 44  ff 01 66 8b 1e 44 7c c7  |.L...|.D..f..D|.|
000000a0  04 10 00 c7 44 02 01 00  66 89 5c 08 c7 44 06 00  |....D...f.\..D..|
000000b0  70 66 31 c0 89 44 04 66  89 44 0c b4 42 cd 13 72  |pf1..D.f.D..B..r|
000000c0  05 bb 00 70 eb 7d b4 08  cd 13 73 0a f6 c2 80 0f  |...p.}....s.....|
000000d0  84 f0 00 e9 8d 00 be 05  7c c6 44 ff 00 66 31 c0  |........|.D..f1.|
000000e0  88 f0 40 66 89 44 04 31  d2 88 ca c1 e2 02 88 e8  |..@f.D.1........|
000000f0  88 f4 40 89 44 08 31 c0  88 d0 c0 e8 02 66 89 04  |..@.D.1......f..|
00000100  66 a1 44 7c 66 31 d2 66  f7 34 88 54 0a 66 31 d2  |f.D|f1.f.4.T.f1.|
00000110  66 f7 74 04 88 54 0b 89  44 0c 3b 44 08 7d 3c 8a  |f.t..T..D.;D.}&lt;.|
00000120  54 0d c0 e2 06 8a 4c 0a  fe c1 08 d1 8a 6c 0c 5a  |T.....L......l.Z|
00000130  8a 74 0b bb 00 70 8e c3  31 db b8 01 02 cd 13 72  |.t...p..1......r|
00000140  2a 8c c3 8e 06 48 7c 60  1e b9 00 01 8e db 31 f6  |*....H|`......1.|
00000150  31 ff fc f3 a5 1f 61 ff  26 42 7c be 7f 7d e8 40  |1.....a.&amp;B|..}.@|
00000160  00 eb 0e be 84 7d e8 38  00 eb 06 be 8e 7d e8 30  |.....}.8.....}.0|
00000170  00 be 93 7d e8 2a 00 eb  fe 47 52 55 42 20 00 47  |...}.*...GRUB .G|
00000180  65 6f 6d 00 48 61 72 64  20 44 69 73 6b 00 52 65  |eom.Hard Disk.Re|
00000190  61 64 00 20 45 72 72 6f  72 00 bb 01 00 b4 0e cd  |ad. Error.......|
000001a0  10 ac 3c 00 75 f4 c3 00  00 00 00 00 00 00 00 00  |..&lt;.u...........|
000001b0  00 00 00 00 00 00 00 00  40 e2 01 00 00 00 80 00  |........@.......|
000001c0  02 00 83 fe 3f 86 01 00  00 00 c6 17 21 00 00 00  |....?.......!...|
000001d0  01 87 8e fe ff ff c7 17  21 00 4d d3 de 00 00 00  |........!.M.....|
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="changelog/" class="btn btn-neutral float-right" title="Changelog">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="changelog/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.3.1
Build Date UTC : 2022-11-12 08:04:36.789722+00:00
-->
